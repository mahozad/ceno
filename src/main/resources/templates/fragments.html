<!DOCTYPE html>
<html th:lang="${#locale}" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">

<!-- head -->
<head th:fragment="head(titleAppend)">
  <meta charset="UTF-8"/>
  <title th:text="#{name} + ${titleAppend}"></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="author" content="Mahdi Hosseinzadeh, Babak Shahriari"/>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <!-- For android browsers [https://stackoverflow.com/q/26960703] -->
  <meta name="theme-color" th:content="${#themes.code('primary-color')}"/>
  <link rel="icon" type="image/png" sizes="32x32" th:href="@{|/img/favicon-${#themes.code('name')}.png|}"/>
  <link rel="stylesheet" th:href="@{/css/main.min.css}"/>
  <style th:text="':root{'
        + '--primary-color:' + ${#themes.code('primary-color')} + ';'
        + '--secondary-color:' + ${#themes.code('secondary-color')} + ';'
        + '--tertiary-color:' + ${#themes.code('tertiary-color')} + ';' + '}'">
  </style>
  <script th:src="@{/webjars/jquery/jquery.min.js}" defer></script> <!-- todo: replace with cdn -->
  <script th:src="@{/js/main.min.js}" defer></script>
</head>

<body>

<!-- page prompt -->
<div class="page-prompt" th:fragment="prompt" th:if="${prompt != null}">
  <div class="page-prompt-text" th:text="#{${prompt}}"></div>
</div>

<!-- navigation bar -->
<nav th:fragment="navigation">
  <div class="nav-container">
    <div class="hamburger-icon hidden">&#9776;</div>
    <div class="side-nav">
      <div class="close-cat">&times;</div>
      <div class="vert-cat">
        <a th:href="@{/}" th:text="#{footer.home}"></a>
        <div th:replace="this::cats">Categories</div>
      </div>
    </div>
    <div class="logo-search-container">
      <a th:href="@{/}" th:title="#{name}">
        <svg class="brand-logo" width="32" height="32" version="1.1" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
          <g stroke-width="4.56763792">
            <path d="m12.941641 27.61861c-5.3289107 0-10.6578224-3.80636-10.6578224-10.65782s5.3289117-10.65782 10.6578224-10.65782c4.567638 0 8.75464 0.99539 12.941641-1.90319" stroke-dasharray="47" stroke-dashoffset="47">
              <animate id="anim1" attributeName="stroke-dashoffset" from="47" to="0" dur="1500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="0s; anim2.end"></animate>
              <animate id="anim2" attributeName="stroke-dashoffset" from="94" to="47" dur="1500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="anim1.end + 10s"></animate>
            </path>
            <path d="m14.083556 16.123384c2.701379-1.92435 5.856988-2.055442 6.851456-2.055438 0.994466 5e-6 4.150075-0.131087 6.851454-2.055437" stroke-dashoffset="15" stroke-dasharray="15">
              <animate id="anim3" attributeName="stroke-dashoffset" from="15" to="0" dur="500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="anim1.begin + 1200ms"></animate>
              <animate id="anim4" attributeName="stroke-dashoffset" from="30" to="15" dur="500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="anim2.begin + 1200ms"></animate>
            </path>
            <path d="m15.986736 23.736114c2.701379-1.92435 5.856988-2.055442 6.851456-2.055438 0.994466 5e-6 4.150075-0.131087 6.851454-2.055437" stroke-dashoffset="15" stroke-dasharray="15">
              <animate attributeName="stroke-dashoffset" from="15" to="0" dur="500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="anim3.begin + 150ms"></animate>
              <animate attributeName="stroke-dashoffset" from="30" to="15" dur="500ms" fill="freeze" calcMode="spline" keyTimes="0; 1" keySplines=".42,0,.58,1" begin="anim4.begin + 150ms"></animate>
            </path>
          </g>
        </svg>
      </a>
      <div class="search-container">
        <form class="search-form" th:action="@{/search}">
          <label for="search-field"></label>
          <input id="search-field" class="search-input" type="text" name="q" autocomplete="off"
                 th:placeholder="#{search-placeholder}" aria-label="search"/>
          <button type="submit" class="search-button">
            <svg viewBox="0 0 72 72" class="search-icon" xmlns="http://www.w3.org/2000/svg">
              <g transform="translate(-13.999989,-966.36219)">
                <path d="m 42.998529,966.36219 c -15.97982,0 -28.99854,13.01861 -28.99854,28.99854 0,15.97987 13.0187,28.99857 28.99854,28.99857 6.91114,0 13.25932,-2.4431 18.24908,-6.4997 l 19.62402,19.624 c 1.17141,1.1714 3.0783,1.1715 4.24978,0 1.17147,-1.1715 1.17147,-3.0471 0,-4.2185 l -19.62401,-19.624 c 4.06479,-4.9923 6.49967,-11.3615 6.49967,-18.28037 0,-15.97993 -13.01871,-28.99854 -28.99854,-28.99854 z m 0,5.9997 c 12.73733,0 22.99884,10.26142 22.99884,22.99884 0,12.73727 -10.26153,22.99887 -22.99884,22.99887 -12.73731,0 -22.99884,-10.2616 -22.99884,-22.99887 0,-12.73742 10.26151,-22.99884 22.99884,-22.99884 z"></path>
              </g>
            </svg>
          </button>
        </form>
      </div>
    </div>
    <div class="cat-container">
      <a th:fragment="cats" th:each="category:${T(ir.ceno.model.Category.HomepageCategory).values()}"
         th:href="@{|/categories/${category.name().toLowerCase()}|}" th:text="#{${category.name().toLowerCase()}}"
         th:classappend="${#httpServletRequest.requestURI.endsWith(category.name().toLowerCase())} ? ' active'">
      </a>
    </div>
    <div class="usr">
      <div class="usr-log" sec:authorize="!isAuthenticated()">
        <a id="log-in" th:text="#{log-in}">Log in</a>
        <a id="sign-up" th:text="#{sign-up}">Sing up</a>
      </div>
      <div class="usr-inf-container" sec:authorize="isAuthenticated()">
        <a id="new-post" class="btn" th:href="@{/posts/new}" th:text="#{new-post}"></a>
        <div class="author-inf-nav">
          <img class="card-avatar" th:alt="${#authentication.principal.username}"
               onerror="this.src='/img/placeholder.svg'"
               th:src="@{|/users/avatars/${#authentication.principal.username}|}"/>
          <div class="author">
            <div class="usr-name" th:text="${#authentication.principal.username}"></div>
            <div class="score" th:include="this::score" th:with="score=${#authentication.principal.score}"></div>
          </div>
        </div>
        <form th:action="@{/logout}" method="post" th:title="#{log-out}">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <svg viewBox="0 0 105 100" class="logout" xmlns="http://www.w3.org/2000/svg">
            <path d=" M 42.47 10.75 C 53.11 8.72 64.72 11.05 73.31 17.76 C 75.80 19.79 73.06 24.36 70.09 23.12 C 67.31 21.89 64.88 19.99 62.01 18.95 C 50.90 14.51 37.55 16.79 28.46 24.54 C 17.12 33.85 13.40 50.96 19.83 64.15 C 25.76 77.28 40.88 85.36 55.11 82.91 C 60.58 82.27 65.35 79.44 70.09 76.88 C 73.01 75.51 75.83 80.23 73.32 82.24 C 61.42 91.49 44.08 92.37 30.97 85.14 C 21.24 79.87 13.83 70.45 11.21 59.68 C 8.79 50.08 10.10 39.59 14.87 30.92 C 20.46 20.54 30.88 12.90 42.47 10.75 Z"></path>
            <path d=" M 73.76 38.18 C 72.15 35.85 74.89 32.45 77.53 33.46 C 80.44 35.08 82.43 37.91 84.86 40.15 C 87.61 43.14 90.95 45.63 93.24 49.02 C 93.96 51.32 91.72 52.88 90.39 54.36 C 86.21 58.20 82.56 62.61 78.20 66.26 C 75.67 68.14 71.81 64.39 73.72 61.83 C 76.15 58.69 79.26 56.16 81.97 53.27 C 69.95 53.16 57.92 53.46 45.91 53.14 C 42.40 52.96 42.55 46.87 46.03 46.77 C 57.98 46.50 69.95 46.76 81.90 46.66 C 79.26 43.77 76.14 41.30 73.76 38.18 Z"></path>
          </svg>
        </form>
      </div>
    </div>
  </div>
</nav>

<!-- login and sign up -->
<div th:fragment="login-dialog" id="login-dialog" sec:authorize="!isAuthenticated()">
  <div class="log-form">
    <span class="close">&times;</span>
    <div id="register-wrapper">
      <form class="register-form" th:action="@{/register}" method="post" enctype="multipart/form-data" novalidate>
        <div class="input">
          <input id="log-name" class="flat-inp" type="text" name="username" required autocomplete="off"/>
          <span class="highlight"></span>
          <label for="log-name" class="label" th:text="#{username}">Username</label>
          <div class="prompt" th:text="#{prompt.already-taken}">Already taken</div>
        </div>
        <div class="input">
          <input id="log-pass" class="flat-inp" type="password" name="password" required/>
          <span class="highlight"></span>
          <label for="log-pass" class="label" th:text="#{password}">Password</label>
          <div class="prompt" th:text="#{prompt.invalid}">Invalid</div>
        </div>
        <div class="avatar-upload">
          <img th:src="@{/img/placeholder.svg}" alt="avatar"/>
          <label class="file-upload">
            <input type="file" name="avatar" accept="image/*"/>
            <span th:text="#{avatar.change}">Change avatar</span>
          </label>
        </div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button class="btn" type="submit" th:text="#{sign-up}">Sign up</button>
        <p><span th:text="#{prompt.log-in-part-1}"></span> <span class="log-prompt" th:text="#{prompt.log-in-part-2}"></span></p>
      </form>
    </div>
    <div id="login-wrapper">
      <div class="login-form">
        <div class="input">
          <input id="reg-name" class="flat-inp" type="text" name="username" required autocomplete="off"/>
          <span class="highlight"></span>
          <label for="reg-name" class="label" th:text="#{username}">Username</label>
          <div class="prompt" th:text="#{prompt.required}">Required</div>
        </div>
        <div class="input">
          <input id="reg-pass" class="flat-inp" type="password" name="password" required/>
          <span class="highlight"></span>
          <label for="reg-pass" class="label" th:text="#{password}">Password</label>
          <div class="prompt" th:text="#{prompt.required}">Required</div>
        </div>

        <div class="check-box remember-me">
          <input type="checkbox" name="remember-me" id="remember-me">
          <label for="remember-me">Remember me</label>
        </div>

        <div class="invalid-login" th:text="#{prompt.login-fail}">Login failed</div>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <button class="btn" type="submit" th:text="#{log-in}">Log in</button>
        <p><span th:text="#{prompt.sign-up-part-1}"></span> <span class="log-prompt" th:text="#{prompt.sign-up-part-2}"></span></p>
      </div>
    </div>
  </div>
</div>

<!-- card top section -->
<div class="top-container" th:fragment="card-top-section">
  <header class="card-header">
    <div class="author-info">
      <img class="card-avatar" onerror="this.src='/img/placeholder.svg'"
           th:src="@{|/users/avatars/${post.author.username}|}" th:alt="${post.author.username}"/>
      <div class="author">
        <div class="usr-name" th:text="${post.author.username}">Username</div>
        <div class="score" th:fragment="score" th:with="score=${post.author.score}">
          <span th:text="${score}">Score</span>
          <img th:if="${score lt 100}" title="Novice!" th:title="#{novice}"
               th:src="@{/img/ic-medal-beginner.svg}" alt="medal"/>
          <img th:if="${score gt 99 and score lt 1000}" alt="medal" th:src="@{/img/ic-medal-bronze.svg}"/>
          <img th:if="${score gt 999 and score lt 50000 }" th:src="@{/img/ic-medal-silver.svg}" alt="medal"/>
          <img th:if="${score gt 49999}" th:src="@{/img/ic-medal-gold.svg}" alt="medal"/>
        </div>
      </div>
    </div>
    <div class="status-icons">
      <div class="meters" th:fragment="card-like">
        <div class="like-num" th:text="${post.likesCount}">Likes count</div>
        <div class="heart" sec:authorize="isAuthenticated()"
             th:classappend="${#authentication.principal.favorites.contains(post)} ? 'liked' : 'not-liked'">
        </div>
        <div class="heart-static" sec:authorize="!isAuthenticated()" th:title="#{prompt.not-logged-in}"></div>
      </div>
      <svg class="hot-icon" viewBox="0 0 71 90"
           th:if="${post.commentsCount} >= ${T(ir.ceno.model.Post).COMMENTS_COUNT_TO_BE_HOT}">
        <title th:text="${post.commentsCount + ' '} + #{comments}">Hot!</title>
        <path d="m 39.715,0 c 0,0 -5.776,3.879 -4.934,11.329 0.793,7.021 3.832,10.488 3.832,10.488 0,0 4.692,-3.166 2.183,-11.683 C 39.693,6.39 38.877,5.988 39.715,0 Z"></path>
        <path d="m 46.902,13.322 c 0,0 0.441,2.288 -1.142,5.898 -1.586,3.608 2.197,6.776 2.197,6.776 0,0 5.722,-6.25 -1.055,-12.674 z"></path>
        <path d="M 65.31,52.568 C 60.734,67.18 55.629,69.38 55.629,69.38 69.976,42.36 44.099,24.931 44.099,24.931 c 12.06,16.987 2.992,31.512 2.992,31.512 0,0 5.633,-12.06 -8.802,-24.733 C 22.184,16.834 30.191,4.601 30.191,4.601 16.023,9.441 15.582,22.205 18.483,27.309 26.846,41.215 23.59,47.995 23.59,47.995 23.413,44.913 21.126,42.624 13.91,37.431 6.691,32.238 11.177,22.732 11.177,22.732 6.516,25.637 2.378,35.142 8.011,41.745 18.309,54.595 9.771,61.988 9.771,61.988 13.204,47.729 0,44.56 0,44.56 10.211,52.834 0.795,58.996 2.377,68.675 5.369,91.474 31.599,89.98 31.599,89.98 c 0.747,-0.007 1.452,-0.053 2.166,-0.09 -9.865,-0.025 -12.61,-6.185 -10.173,-8.542 0,0 4.004,-3.469 -0.827,-9.497 -2.643,-3.101 -0.701,-7.56 1.486,-8.921 0,0 -2.105,4.459 1.281,6.896 3.387,2.437 4.461,3.509 4.542,4.955 0,0 1.528,-3.182 -2.396,-9.704 -1.361,-2.393 -1.155,-8.383 5.494,-10.653 0,0 -3.758,5.738 3.798,12.72 6.772,5.943 4.131,11.604 4.131,11.604 0,0 4.253,-6.814 -1.405,-14.786 0,0 12.143,8.18 5.412,20.855 0,0 -1.569,3.591 -7.495,4.726 C 67.716,85.39 65.31,52.568 65.31,52.568 Z"></path>
      </svg>
      <div class="share-container">
        <svg class="share-icon" viewBox="0 0 70 78" xmlns="http://www.w3.org/2000/svg">
          <path d="m 57.1,25.800004 c 7.1,0 12.9,-5.8 12.9,-12.9 C 70,5.799997 64.2,0 57.1,0 50,0 44.2,5.799997 44.2,12.900004 c 0,1.4 0.2,2.7 0.6,3.9 l -22.3,12.9 c -2.4,-2.6 -5.8,-4.2 -9.5,-4.2 -7.2,0 -13,5.8 -13,12.9 0,7.1 5.8,12.9 12.9,12.9 3.8,0 7.2,-1.6 9.5,-4.2 l 22.3,12.9 c -0.4,1.2 -0.6,2.6 -0.6,3.9 0,7.1 5.8,12.9 12.9,12.9 7.1,0 12.9,-5.8 12.9,-12.9 0,-7.1 -5.8,-12.9 -12.9,-12.9 -3.8,0 -7.2,1.6 -9.5,4.2 l -22.3,-12.9 c 0.4,-1.2 0.6,-2.6 0.6,-3.9 0,-1.4 -0.2,-2.7 -0.6,-3.9 l 22.3,-12.9 c 2.4,2.6 5.8,4.2 9.6,4.2 z"></path>
        </svg>
        <div class="share-content">
          <div class="arrow"></div>
          <a th:fragment="share" th:each="share:${T(ir.ceno.model.Post.ShareUrl).values()}"
             th:href="@{|${share.url + post.url}|}" target="_blank" rel="noopener">
            <img th:src="@{|/img/ic-soc-${share.name}.svg|}" th:alt="${share.name}"
                 th:title="${'Share on ' + share.name}"/>
          </a>
        </div>
      </div>
    </div>
  </header>
  <div th:fragment="card-file">
    <img th:if="${post.fileDetails.type.name() == 'IMAGE'}" class="card-img"
         th:src="@{|/posts/images/${post.id}|}" alt="cover" onerror="this.src='/img/placeholder-img.svg'"/>

    <div th:if="${post.fileDetails.type.name() == 'VIDEO'}" class="video-container">
      <video class="card-video" loop preload="metadata">
        <source th:src="@{|/posts/videos/${post.id}|}"/>
        <span th:text="#{prompt.video-not-supported}"></span>
      </video>
      <div class="ply-btn">
        <button class="ply-ico" aria-label="play"></button>
      </div>
      <progress max="100" value="0" class="prog-bar"></progress>
    </div>
  </div>
  <article th:fragment="card-article">
    <h1 th:text="${post.title}">Title</h1>
    <p th:text="${post.summary}">Summary</p>
  </article>
</div>

<!-- card chips -->
<div class="chips-container" th:fragment="card-chips">
  <div th:each="cat:${post.categories}">
    <a class="chip" th:text="${cat.name}" th:href="@{|/categories/${cat.name}|}"></a>
  </div>
</div>

<!-- card read more -->
<a class="read-more" th:fragment="card-read-more" th:href="@{|/posts/${post.url}|}" th:text="#{card.read-more}"></a>

<!-- card date -->
<div class="card-date" th:fragment="card-datetime" th:text="${@dateTimeFormatter.formatPostDataTime(post)}"></div>

<!-- footer -->
<footer class="page-footer" th:fragment="footer">
  <div class="footer-container">
    <div class="up-foot">
      <div class="foot-links">
        <div class="foot-follow-us">
          <span class="follow-prompt" th:text="#{footer.follow}">Follow Ceno</span>
          <a th:href="@{http://www.facebook.com/ceno}" target="_blank" rel="noopener">
            <img class="follow-us-image" alt="facebook" th:src="@{/img/ic-soc-facebook.svg}"/>
          </a>
          <a th:href="@{http://www.twitter.com/ceno}" target="_blank" rel="noopener">
            <img class="follow-us-image" alt="twitter" th:src="@{/img/ic-soc-twitter.svg}">
          </a>
          <a th:if="${#httpServletRequest.requestURI.startsWith('/categories')} " th:href="@{|/rss/${catName}|}">
            <!--suppress RequiredAttributes -->
            <img class="follow-us-rss" alt="rss" th:src="@{/img/ic-rss.svg}"/>
          </a>
        </div>
        <div class="foot-preferences">
          <div class="theme-choose">
            <span class="theme-prompt" th:text="#{footer.select-theme}"></span>
            <div class="themes">
              <div class="theme theme-cyan" data-theme-name="cyan"
                   th:classappend="${#themes.code('name') == 'cyan'}?'theme-active'">
              </div>
              <div class="theme theme-orange" data-theme-name="orange"
                   th:classappend="${#themes.code('name') == 'orange'}?'theme-active'">
              </div>
              <div class="theme theme-pink" data-theme-name="pink"
                   th:classappend="${#themes.code('name') == 'pink'}?'theme-active'">
              </div>
            </div>
          </div>
          <div class="lang-prompt" th:text="#{footer.select-lang}"></div>
          <div class="langs">
            <div class="lang" data-lang-name="en">
              <img class="lang-flag" th:src="@{/img/ic-lang-en.png}" alt="english"/>
              <span class="lang-name">English</span>
            </div>
            <div class="lang" data-lang-name="fa">
              <img class="lang-flag" th:src="@{/img/ic-lang-fa.png}" alt="farsi"/>
              <span class="lang-name">فارسی</span>
            </div>
          </div>
        </div>
        <div class="foot-sec-1">
          <a th:href="@{/}" th:text="#{footer.home}"></a>
          <a th:href="@{/about}" th:text="#{footer.about}"></a>
          <a th:href="@{/contact}" th:text="#{footer.contact-us}"></a>
          <a th:href="@{/ads}" th:text="#{footer.ads}"></a>
        </div>
        <div class="foot-sec-2">
          <a th:href="@{/faq}" th:text="#{footer.faq}"></a>
          <a th:href="@{/help}" th:text="#{footer.help}"></a>
          <a th:href="@{/tos}" th:text="#{footer.tos}"></a>
          <a th:href="@{/privacy}" th:text="#{footer.policy}"></a>
        </div>
      </div>
    </div>
  </div>
  <div class="copyright" th:text="' © ' + #{name} + ' ' + ${T(java.time.LocalDate).now().getYear()}"></div>
</footer>

</body>
</html>
